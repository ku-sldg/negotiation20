\documentclass[sigconf,authordraft]{acmart}
\usepackage{tikz}
\usepackage{todonotes}
\usepackage{alltt}
\usepackage[nonumberlist]{glossaries}
\makeglossaries
\input{glossary}
\input{prelude}

\usetikzlibrary{arrows}

\newcommand{\den}[2][]{
\left\llbracket#2\right\rrbracket^{#1}
}
\newcommand{\low}[1]{
\left\lfloor#1\right\rfloor
}
\newcommand{\denml}[1]{
  \den[ml]{#1}
}
\newcommand{\denev}[1]{
  \den[ev]{#1}
}

%%\newcommand{\squash}{\itemsep=0pt\parskip=0pt}
\newcommand{\uavam}{\textsf{UAVAM}}
\newcommand{\useram}{\textsf{UserAM}}
\newcommand{\platam}{\textsf{PlatformAM}}
\newcommand{\selam}{\textsf{seL4AM}}
\newcommand{\uboot}{\textsf{UBOOT}}
\newcommand{\duhk}{\textsf{DUHK}}
\newcommand{\M}[1]{\ensuremath{M_{\mathsf{#1}}}}
\newcommand{\E}[1]{\ensuremath{E_{\mathsf{#1}}}}
\newcommand{\R}[1]{\ensuremath{R_{\mathsf{#1}}}}
\newcommand{\sign}[2]{\ensuremath{\{#1\}_{#2^{-1}}}}
%%\newcommand{\placee}[1]{\cnc{PL_#1}}
\newcommand{\bara}{\bar{a}}

%% The article template's documentation, available at
%% \url{https://www.acm.org/publications/proceedings-template}, has a
%% complete explanation of these commands and tips for their effective
%% use.

\setcopyright{acmcopyright}
\copyrightyear{2020}
\acmYear{2020}
\acmDOI{0000}

%% These commands are for a PROCEEDINGS abstract or paper.
\acmConference[Attestation Negotiation]{Working Paper on Attestation
  Negotiation}{20 January, 2020}{Lawrence, KS}
\acmBooktitle{No Book}
\acmPrice{0.00}
\acmISBN{0000}

%%\acmSubmissionID{123-A56-BU3}


\begin{document}

\title{Negotiating Attestation Protocols}

\author{Anna Fritz} \email{arfritzz@ku.edu} \author{Perry Alexander}
\orcid{0000-0002-5387-9157} \email{palexand@ku.edu} \affiliation{%
  \institution{ITTC - The University of Kansas} \streetaddress{2335
    Irving Hill Rd} \city{Lawrence} \state{Kansas} \country{USA}
  \postcode{66045} }

\renewcommand{\shortauthors}{Fritz and Alexander}

\begin{abstract}
  Abstract goes here
\end{abstract}

%%
%% The code below is generated by the tool at
%% http://dl.acm.org/ccs.cfm.  Please copy and paste the code instead
%% of the example below.
%%
\begin{CCSXML}
  <ccs2012> <concept>
  <concept_id>10010520.10010553.10010562</concept_id>
  <concept_desc>Computer systems organization~Embedded
  systems</concept_desc>
  <concept_significance>500</concept_significance> </concept>
  <concept> <concept_id>10010520.10010575.10010755</concept_id>
  <concept_desc>Computer systems
  organization~Redundancy</concept_desc>
  <concept_significance>300</concept_significance> </concept>
  <concept> <concept_id>10010520.10010553.10010554</concept_id>
  <concept_desc>Computer systems organization~Robotics</concept_desc>
  <concept_significance>100</concept_significance> </concept>
  <concept> <concept_id>10003033.10003083.10003095</concept_id>
  <concept_desc>Networks~Network reliability</concept_desc>
  <concept_significance>100</concept_significance> </concept>
  </ccs2012>
\end{CCSXML}

\ccsdesc[500]{Computer systems organization~Embedded systems}
\ccsdesc[300]{Computer systems organization~Redundancy}
\ccsdesc{Computer systems organization~Robotics}
\ccsdesc[100]{Networks~Network reliability}

\keywords{TBD}

\maketitle

\section{Introduction}

\citet{Martin:08:The-ten-page-in} defines trust as unambiguous
identification, unhindered operation, and direct observation of good
behavior or indirect observation by a trusted third party.  Semantic
remote attestation~\cite{Haldar:04:Semantic-Remote} is a technique by
which a target provides evidence used to establish trust in its
execution.  Shown in figure~\ref{fig:architecture-fig} an
\emph{appraiser} makes a request ($r:R$) of a \emph{target} where
attestation then generates and returns evidence ($e:E$) that is
appraised to determine trust.

\begin{figure}[hbtp]
  \centering \input{architecture-fig-simpl.tex}
  \caption[Attestation architecture]{Remote attestation architecture
    showing an \emph{appraiser} making an attestation request of a
    \emph{target}.}
  \Description{Remote attestation basic architecture.}
  \label{fig:architecture-fig}
\end{figure}

\citet{Coker::Principles-of-R,Coker:08:Attestation:-Ev} define a
remote attestation model where a target executes an \emph{attestation
  protocol} that gathers evidence and generates meta-evidence for
appraisal.  The protocol sequences the execution of attestation
services that perform measurement, generate cryptographic signatures,
and make requests of other systems. These protocols are executed by an
\emph{attestation manager} associated with the appraiser or target.

Figure~\ref{fig:sequence-fig} illustrates the process of negotiating
and executing an attestation protocol.  An appraiser and target first
establish a security association that identifies appraiser and target,
sets up secure communication, and establishes a security domain
providing context for negotiation.  The appraiser then sends a request
to the target describing the evidence and meta-evidence it needs for
appraisal.  The target produces a proposal consisting of a protocol
set that responds to the request while obeying the target's local
policy. Based on the selection policy, the appraiser chooses a
protocol from the proposal that the target then executes.  The
resulting evidence is returned to the appraiser and evaluated to
determine trust.

Negotiation is guided by the five principles of remote attestation
created by \citet{Coker::Principles-of-R,Coker:08:Attestation:-Ev}
which include

\begin{itemize}
\item Fresh information - attestation results reflect the running
  system
\item Comprehensive information - measurement results satsify the
  appraiser's standards
\item Constrained discloure - target governs what measurements are
  acceptable for attestation
\item Semantic explicitness - logical and uniform semantics govern
  communication
\item Trustworthy mechanism - attestation architecture must be proven
  trustworthy
\end{itemize}

Providing compreshensive information and maintaining constrained
discloure are the foucs of negotiation as we aim to find a measuement
that satisifies the requirements of the appraiser and restrictions of
the target.

Following we will formally define a negotiation process, define
properties of an ideal protocol, and show that the negotiation process
produces ideal protocols.  We will then instantiate the model for
several systems to provide examples of its use.

%% The negotiation of an attestation protocol satisfying the
%% requirements of the appraiser and restrictions of the target is our
%% objective here.  Following we will formally define a negotiation
%% process, define properties of an ideal protocol, and show that the
%% negotiation process produces ideal protocols.  We will then
%% instantiate the model for several systems to provide examples of
%% its use.

\section{Attestation Protocols}

An \emph{attestation protocol} is a sequence of attestation actions
executed by an \emph{attestation manager}. Our representation language
for protocols is Copland~\citep{Ramsdell:2019aa}, a language for
orchestrating attestation actions.  Copland provides a convenient
syntax and semantics for protocol execution as well as a formal
semantics for modeling, verification and synthesis.  Copland is
parameterized over work units.  Specifically, it is agnostic to the
kinds of work performed by attestation guaranteeing only work
sequencing and dispatch.

%% something about evidence and metaevidence somewhere

Copland calls protocols \emph{phrases} that are in turn executed at a
\emph{place}.  Each place identifies and attestation manager and has a
private key for signing and public key for signature checking and
identification.  For simplicity in this work we use names or numbers
to identify places.  Each phrase is constructed from a minimal
operator set that includes:

\begin{itemize}
  \squash
\item measurement---generating evidence from a system
\item meta-measurement---generating meta-evidence from evidence
\item sequencing---ordering measurements
\item dispatching---requesting evidence from other providers
\end{itemize}

Measurements gather evidence from systems that may range from a simple
file hash to sophisticated contextual inspection results gathered at
run-time.  Each measurement has two associated place identifiers
representing the place where it runs and the place that is measured.
If those places are the same, the measurement is called a \emph{user
  space} measurement.  If those places are different, the measurement
is called a \emph{kernel integrity measurement}.  This distinction is
important when evaluating chains of trust.  The format of a
measurement is \verb+<id> <source> <target>+

Meta-measurements generate evidence over evidence including
signatures, hashes and copies.  Signatures are generated by the place
executing the signature command using the place's private key.  This
provides evidence that the place possessed the measurement and is used
in the canonical fashion to check integrity and authenticity.  The
format of meta-measurements are \verb+SIG+, \verb+CPY+ and \verb+HASH+
respectively.

Each attestation manager is responsible for providing evidence of a
target system's state, they are also responsible for providing
meta-evidence. While evidence is the tangible result of attestation,
meta-evidence assures the appraiser that evidence was gathered
correctly. Together, evidence and meta-evidence result in an accurate
depiction of the current state of the target system.

Sequencing composes and orders phrases sequentially or in parallel.
Linear sequencing of the form $(T_1 \mathtt{->} T_2)$ states that term
$T_1$ executes before $T_2$ and evidence generated by $T_1$ is
consumed by $T_2$.  The phrase \verb+(probe p p) -> SIG})+ runs the
\textsf{probe} measurement on $p$ and signs the result.  Sequential
splitting operations route data to phrases that are then executed in
sequence.  The phrase $T_1 s_l\mathtt{<}s_r T_2$ where $s$ is either
$+$ or $-$ indicating where data is routed.  The phrase:

\begin{alltt}
  n -> ((probe p p) -<+ CPY) -> SIG
\end{alltt}

\noindent takes a nonce value, \verb+n+, and runs the \verb+probe+
measurement and the \verb+CPY+ meta-measurement in sequence.  The
\verb!-<+! operation indicates the left phrase runs followed buy the
second while input evidence goes to the right and not the left phrase.
The \verb+probe+ measurement consumes no evidence and produces
measurement evidence while \verb+cpy+ produces a copy of its input,
the nonce.  The result is an evidence pair \verb+(E;n)+ consisting of
measurement evidence and nonce.  Finally, the pair is signed by the
executing place. resulting in \verb+(sig (M;n) p)+ where \verb+p+
identifies the signing place and \verb+;+ indicates the evidence and
copy operations were done in sequential order.  This particularly
Copland phrase is useful for asking a place to generate evidence in
the presence of a nonce and sign the result.

The same phrase could use parallel composition.  In this case the
phrase would have the form:

\begin{alltt}
  n -> ((probe p p) -~+ CPY) -> SIG
\end{alltt}

\noindent where the \verb+~+ operator indicates the copy and
measurement operations may be done in any order.  The resulting
evidence has the form \verb+(sign (m|n) p)+ where the \verb+|+
indicates evidence and nonce appear in arbitrary order.  This phrase
is weaker than the previous phrase because of the relaxed evidence
order.  Such ordering is critical to attestation protocols and
explored elsewhere~\cite{Rowe:2016bi}.

The dispatch operation allows an attestation manager to make a request
of another attestation manager.  The phrase:

\begin{alltt}
  @q(n -> @p((probe p p) -~+ CPY) -> SIG)
\end{alltt}

\noindent represents place \verb+q+ requesting that place \verb+p+
execute the probe-and-sign Copland phrase.  The \verb+@+ operation
provides execution location information to the protocol.  The
\verb+SIG+ operator will invoke signing with \verb+p+'s private
key. The subtle change:

\begin{alltt}
  @q(n -> @p((probe p p) -~+ CPY)) -> SIG
\end{alltt}

\noindent would cause \verb+q+ to sign evidence dramatically changing
what the resulting evidence indicates.

\section{Protocol Negotiation}

Negotiation introduces a path for communication between target and
appraiser. When successful, a protocol is identified that satifies the
targets needs for constrained disclosure and the apprisers desire for
comprehensive information.

To begin, it is critical to obtain a common vocabulary between appriaser and target for the success of negotiation. This can be accomplished by guiding the two negotiating parties through ISAKMP to establish a security association (SA).  More precisely,
a SA is a multifaceted agreement between two communicating peers that
establishes identification, keys, and security labels. The SA also
includes headers that declare the domain of interpretation, aspects of 
situational awareness and the duration the SA is valid. The goal is to generate a  cerificate, valid betwen appraiser and target, to
authenticate a common domain of interpretation.

With an established security association, the appraiser sends the request for an attestation protocol to the target.  We
define $A$ as the type of appraisers and $T$ the type of targets.  $R$
is the type of attestation requests that define the needs of the
appraiser.  $P$ is the type of protocols represented as Copland
phrases.  $E$ is the type of evidence generated by protocol execution.

Ideally the appraiser $a:A$ makes a request $r:R$ of some target
$t:T$, a protocol $p:P$ is selected and executed by $t$ returning
evidence $e:E$ for evaluation by $a$. We define $\langle P \rangle$ as
vectors of protocols representing \emph{proposals}.  When an appraiser
makes a request, the target returns some $q:\langle P \rangle$ whose
protocols fully or partially satisfy the request. The target chooses
and orders $q:\langle P\rangle$ by examining evidence produced by
executing protocols defined by Copland's evidence semantics
$\mathcal{E}$.

Figure~\ref{fig:sequence-fig} defines the process of protocol
negotiation and execution.  $r:R$ is sent from appraiser to target.
The target responds with a $q:\langle P\rangle$ defining potential
protocols.  The appraiser chooses one protocol, $p:P$, by direct
selection and instantiation of a parameterized protocol.  That
protocol is then executed by the target and evidence, $e:E$, returned
to the appraiser.  The evidence is then appraised to determine trust.

Selection of $p$ is achieved by finding the ``best'' protocol that
satisfies the needs of the appraiser while respecting the privacy of
the target. The notion of ``best'' is situationally dependent and can
change for different attestation scenarios, targets, and appraisers.
Furthermore, the preferences and policies of targets and appraisers
are not and should not be globally known.  Thus, negotiation between
$a$ and $t$ is essential for finding a ``best'' protocol.

\begin{figure}[hbtp]
  \centering \input{sequence-fig.tex}
  \caption[Attestation process]{Attestation process.}
  \Description{Attestation sequence.}
  \label{fig:sequence-fig}
\end{figure}

\section{Ordering Evidence}

One piece of evidence can be considered superior to another based on situationally dependent criteria (and policy?) such as attestation goals and timing requirements. This illustrates an ordering over evidence descriptions which results in a partially ordered set $(E,\preceq)$. If $e_1$ and $e_2$ are evidence descriptions, or vectors of evidence, then $e_1\preceq e_2$ expresses a preference for $e_2$ over $e_1$. Taken further, $(E,\preceq,\top,\bot)$ defines a lattice where $E$ and every subset of $E$ has one or more maxima.  The maxima, or $\top$, defines the best or most preferred piece evidence.

The target and appraiser likely express different preferences for evidence becuase they enforce different attestation goals. As such, the evidence lattice for the target and appraiser are distinct.  These unique lattices can be denoted $(E_T,\preceq,\top,\bot)$ and $(E_A,\preceq,\top,\bot)$ for the target and appraiser, respectively. (Should I talk here about where the lattices arise? Or why they are different?) 

\section{Policy}

Two policies influence the production of a protocol, $p$. The \emph{privacy policy} is enforced to protect a place's interest while the \emph{selection policy} is a relation that maps concrete actions to abstract goals. The \emph{privacy policy} and \emph{selection policy} are unique for each attestation system and can be conflated to \emph{local policy}.

The \emph{privacy policy} is an abstract collection of goals to protect a place's interest. It manifested throughout the negotiation process as the relation $\pi$ and exists between either the target or appraiser and evidence. In some cases, the \emph{privacy policy} implies that the target $t$ has permission to send protocol $p$ which can be evaluated to evidence $e$. This relation can be represented as $\pi_T : T\times E_T$. The \emph{privacy policy} can also ensure the appraiser does not violate its privacy standards when sending the request. This can be represented as a relation  $\pi_A : A\times R$. In other terms, $(a,r)\in\pi_A$ which implies that appraiser $a$ has permission to send request $r$.

The \emph{selection policy} is a mapping of abstract goals to concrete implementations. It exists in many different forms throughout the body of negotiation and can be represented as $\psi$. For instance, we know the appraiser's goal of negotiation is to find the ``best'' protocol for attestation. The realization of the ordering of protocols is the selection policy. In this case, $\psi$ is a relation, not a function, that maps the appraiser's desire for the ``best'' protocol to the concrete implementation of choosing the ``best'' protocol for attestation.

The target must also be cautious about what protocols it shares in the proposal. Therefore, the \emph{selection policy} maps the abstract goal of not violating the target's privacy standards to the concrete goals of not sharing certain protocols. This goal takes the form of \[(\{e:E_T\mid (t,e)\in\pi_T\}\] where evidence is filtered by the target's privacy policy.   

(( where else can we see selection policy? Should I talk about target selection policy that choose protocols that satisfies PP? Do we need to mathematically describe selection cases by case?  )) 

\section{Negotiation Verification}

Once the appriser has recieved a proposal from the target, determining
the best protocol for attestation requires knowledge of the
appriaser's attestation goals. It is not initally obvious how the
appriser should order the protocols to obtain the ``best'' protocol for
attestation. Here, we pose one way to generate the ordering over
protocols.

Knowing that an appraiser's request $r:R$ produces evidence, we can
send a request through attestation to generate all possible pieces of
evidence. In other words, each request made by the appraiser
results in possibly many different protocols that, when executed,
result in distinct pieces of evidence. Combining those pieces of
evidence results in the evidence vector,  $<E>$, from which a situationally
dependent ordering will arise and one piece of evidence will be deemed
``best''. The ``best'' piece of evidence corresponds to the ``best'' protocol. 

What is ``best'' for the appriser my not be fesiable for the
target. Therefore, the $r:R$ is evaluated for the appraiser and the
target seperately. The appraiser's evidence can be ordered represented
in a lattice, $(E_A,\preceq_A, \top, \bot)$, where $\top$ is the
``best'' piece of evidence. However, the target may not give all the
possible protocols that are generated from the request. Most likely,
the target will provide a subset of the protocols in a unique proposal
such that the target ensures it's policies are satisfied. Evaluating
all of the target's possible protocols results in a lattice of
evidence generated by the request, $(E_T,\preceq_T)$.

Both $(E_A,\preceq_A)$ and $(E_T,\preceq_T)$ are a subset of all the
possible evidence, $(E)$. Ideally, $E_A = E_T$ but that is not always
possible.

Knowing the request, we can compare $E_A$ and $E_T$, as seen in
Figure~\ref{fig:policy-fig-embed}. Each piece of evidence can be
evaluated to its inital protocol using the relation
$\varepsilon [\![P]\!] = E$. Since the evidence was initally ordered
in a lattice, the resulting protocols that generated the pieces of
evidence is also ordered in a lattice. There is a distinct lattice for
the appraiser and target, $(P_A,\preceq_A)$ and
$(P_T,\preceq_T)$, respectively. The top of the interestion of the lattices,
$(E_A,\preceq_A) \cdot (E_T,\preceq_T)$, will result in the correct
protocol for attestation.

\begin{figure}[hbtp]
  \centering \input{policy-fig-embed.tex}
  \caption[Attestation process]{Policy figure.}
  \Description{Policy figure.}
  \label{fig:policy-fig-embed}
\end{figure}


\begin{figure}[hbtp]
  \centering \input{certification-fig.tex}
  \caption[Attestation process]{Certification figure.}
  \Description{Certification figure.}
  \label{fig:certification-fig}
\end{figure}

\section{Applications}

\begin{itemize}
\item Single protocol example
\item Protocol shapes examples
\item Complex evidence example

\end{itemize}

  
In this section, we attempt to describe the outcome of various
negotiation scenarios with examples of the appraiser's request and
target's response. In all subsequent cases, assume the appraiser
requests a user space measurement, USM, from place one, to provide a
hash of the virus checker, vc. Unless otherwise noted, the request
will look like $@_1 (\text{USM}\: hash$ vc).

The first example is one such that negotation occurs ``perfectly''
where the targets proposal includes the exact protocol requested. In
this \gls{perfect} scenario, the target will respond with
$@_1 (\text{USM}\: hash$ vc) and possibly some other collection of
Copland terms. The appraiser will implement the selection policy to
find the exact protocol is present in the intersection poset and
select that for attestation. This is called perfect negotiation.

Upon recieving a request, the target could choose to expose all
information by responding with every possible protocol it can generate
so the decision of the correct protocol for attestation is given to
the appriser. In choosing, the appriser will implement its selection
policy to obtain the most effective protocol(s). This is situation is
defined to be \gls{Ideal} as the target is willing to expose all
components of its architecutre.

If the request results in an empty intersection poset, the target
fails negotiation. This situation may occurs when the target cannot
find a protocol to satisfy the request or the target responds with a
proposal of protocols unrelated to the request. In either case, the
appraiser assumes the system is not trusted. It may restart
negotiation with a new request as a separate scenario.

There is also a possiblity that target returns two completely
unrelated pieces of evidence where the appriser must decide which is
more suitable for attestation. For example, if the request is still a
hash of the virus checker, this proposal would then include a hash of
the signature server and a hash of its own attestation manager,
am. This proposal would look like {$@_1 (\text{USM}\: hash$ ss),
  $@_1 (\text{USM}\: hash$ am)}. In either case, the appraiser must
apply its selection policy to attain if the protocols meet the
situational requirements and choose which should be selected for
attestation.

%% It is possible that the target responds with protocols in an
%% unfavorable pairing such that the target is willing to give the
%% exact thing requested but only if it is bundled with other unwanted
%% pieces of evidence.

Unrelated to the specific protocols examples, if the target takes too
long to respond to the appriser's request the negotiation situation
fails. This idea can be enforced through the security association as
there is a lifetime header where the target and the appraiser agree on
the duration that the SA is valid. If the process of negotiation
outlasts the time that the security assoication is valid then
negotiation fails and target is deemed untrusted or negotiation must
restart.

\printglossary \glsaddallunused

\section{Conclusions}

We have presented a model for negotiating attestation protocols that
both meet local policy requirements while producing evidence
satisfying appraiser requirements.

Combining a request, policy, and evidence preference results in
a lattice of evidence satisfying the request:

\[(\{e:E\mid (a,e)\in\pi_T\},\preceq_T,\top_T,\bot_T)\]

Each piece of evidence can be evaluated to the protocol that produced it through the realtion $\mathcal{E}[\![p]\!]=e$. A similar lattice for protocols results:

\[(\{p:P\mid
  (a,\mathcal{E}[\![p]\!]=e)\in\pi_T\},\preceq_T,\top_T,\bot_T)\]

Elements of a proposal $\langle P\rangle$ are generated by
$(\mathsf{map}\; \mathcal{E}\; \langle P\rangle)$ where $\mathcal{E}$
is the Copland evidence semantics defined by \citet{Ramsdell:2019aa}.
Thus, a proposal can be mapped onto the various evidence that each
protocol produces.

\nocite{Coker::Principles-of-R,Ramsdell:2019aa,Petz:2019aa,Davey:02:Introduction-to}

\bibliographystyle{ACM-Reference-Format} \bibliography{sldg}

\end{document}

